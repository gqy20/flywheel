# AI é£è½®å·¥ä½œæµç¨‹

## æ¦‚è¿°

AI ç¼–ç¨‹é£è½®æ˜¯ä¸€ä¸ªåŸºäº GitHub Actions + Claude API çš„è‡ªåŠ¨åŒ–å¼€å‘ç³»ç»Ÿï¼Œéµå¾ª **TDD (æµ‹è¯•é©±åŠ¨å¼€å‘)** æµç¨‹ï¼Œè‡ªåŠ¨å®Œæˆä»£ç æ‰«æã€é—®é¢˜ä¿®å¤å’Œè´¨é‡æå‡ã€‚

---

## æ ¸å¿ƒæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        é£è½®å¾ªç¯                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
        â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Scan        â”‚   â”‚   Evaluate    â”‚   â”‚     Fix       â”‚
â”‚  æ‰«æä»£ç       â”‚   â”‚  è¯„ä¼°ä¼˜å…ˆçº§    â”‚   â”‚   è‡ªåŠ¨ä¿®å¤     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1. Scan é˜¶æ®µ - æ‰«æä»£ç 

### è§¦å‘æ¡ä»¶
- å®šæ—¶è§¦å‘ï¼šæ¯å°æ—¶
- æ‰‹åŠ¨è§¦å‘ï¼š`workflow_dispatch`

### å·¥ä½œæµç¨‹
```
1. æ‰«ææºä»£ç ç›®å½• (src/)
   â”‚
2. è°ƒç”¨ Claude API åˆ†æä»£ç è´¨é‡
   â”‚
3. è¯†åˆ«æ½œåœ¨é—®é¢˜ï¼š
   â”‚   - Bugï¼šä»£ç ç¼ºé™·ã€è¾¹ç•Œæ¡ä»¶é”™è¯¯
   â”‚   - Testï¼šæµ‹è¯•ç¼ºå¤±ã€è¦†ç›–ç‡ä½
   â”‚   - Docsï¼šæ–‡æ¡£ç¼ºå¤±ã€æ³¨é‡Šä¸è¶³
   â”‚   - Refactorï¼šä»£ç å¼‚å‘³ã€é‡å¤ä»£ç 
   â”‚   - Securityï¼šå®‰å…¨éšæ‚£ã€è¾“å…¥éªŒè¯
   â”‚   - Perfï¼šæ€§èƒ½é—®é¢˜ã€ç®—æ³•ä¼˜åŒ–
   â”‚
4. åˆ›å»º GitHub Issueï¼ŒåŒ…å«ï¼š
   â”‚   - æ ‡é¢˜ï¼š[ç±»å‹] ç®€çŸ­æè¿°
   â”‚   - é—®é¢˜æè¿°
   â”‚   - å½±å“èŒƒå›´ï¼ˆæ–‡ä»¶è·¯å¾„ã€å‡½æ•°åï¼‰
   â”‚   - å»ºè®®ä¿®å¤æ–¹æ¡ˆ
   â”‚
5. è‡ªåŠ¨æ‰“æ ‡ç­¾ï¼šp0, p1, p2, p3
```

### Issue æ ¼å¼ç¤ºä¾‹
```markdown
## [Bug] ç©ºæŒ‡é’ˆé£é™©

### é—®é¢˜æè¿°
`Storage.get()` æ–¹æ³•åœ¨æ‰¾ä¸åˆ° todo æ—¶è¿”å› Noneï¼Œä½†è°ƒç”¨æ–¹æœªæ£€æŸ¥ã€‚

### å½±å“èŒƒå›´
- **æ–‡ä»¶**: `src/flywheel/storage.py`
- **å‡½æ•°**: `get(todo_id: int) -> Todo | None`
- **è¡Œå·**: 53-58

### å»ºè®®ä¿®å¤
æ·»åŠ  None æ£€æŸ¥æˆ–è¿”å›é»˜è®¤å€¼ã€‚
```

---

## 2. Evaluate é˜¶æ®µ - è¯„ä¼°ä¼˜å…ˆçº§

### è§¦å‘æ¡ä»¶
- Issue æ ‡ç­¾å˜æ›´æ—¶è‡ªåŠ¨è§¦å‘

### ä¼˜å…ˆçº§è§„åˆ™
```python
def get_priority_score(issue) -> int:
    """æ ¹æ® Issue ç±»å‹è®¡ç®—ä¼˜å…ˆçº§åˆ†æ•°"""
    title = issue.title.lower()

    # å®‰å…¨é—®é¢˜æœ€é«˜ä¼˜å…ˆçº§
    if any(kw in title for kw in ["security", "å®‰å…¨"]):
        return 100  # p0

    # Bug å…¶æ¬¡
    if any(kw in title for kw in ["bug", "ä¿®å¤", "fix"]):
        return 75  # p1

    # æ€§èƒ½é—®é¢˜
    if any(kw in title for kw in ["perf", "æ€§èƒ½"]):
        return 50  # p1/p2

    # æµ‹è¯•è¦†ç›–
    if any(kw in title for kw in ["test", "æµ‹è¯•"]):
        return 30  # p2

    # é‡æ„
    if any(kw in title for kw in ["refactor", "é‡æ„"]):
        return 20  # p2

    # æ–‡æ¡£æœ€ä½
    if any(kw in title for kw in ["doc", "æ–‡æ¡£"]):
        return 10  # p3

    return 20  # é»˜è®¤ p2
```

### ä¼˜å…ˆçº§æ ‡ç­¾
| æ ‡ç­¾ | åˆ†æ•°èŒƒå›´ | å“åº”æ—¶é—´ | è¯´æ˜ |
|------|----------|----------|------|
| p0 | 80-100 | å³æ—¶ | å®‰å…¨é—®é¢˜ã€ä¸¥é‡ bug |
| p1 | 50-79 | 6å°æ—¶å†… | åŠŸèƒ½ç¼ºé™·ã€æ€§èƒ½é—®é¢˜ |
| p2 | 30-49 | æœ¬å‘¨å†… | æµ‹è¯•ç¼ºå¤±ã€ä»£ç è´¨é‡ |
| p3 | 0-29 | æœ‰ç©ºæ—¶ | æ–‡æ¡£ã€éç´§æ€¥ä¼˜åŒ– |
| frozen | N/A | æš‚åœ | ç†”æ–­çŠ¶æ€ï¼Œäººå·¥ä»‹å…¥ |

---

## 3. Fix é˜¶æ®µ - è‡ªåŠ¨ä¿®å¤ (TDD)

### è§¦å‘æ¡ä»¶
- å®šæ—¶è§¦å‘ï¼šæ¯ 2 å°æ—¶
- p0 Issue å³æ—¶è§¦å‘

### TDD å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TDD å››é˜¶æ®µå¾ªç¯                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”´ RED é˜¶æ®µ
â”œâ”€ 1. åˆ†æ Issue ä¸Šä¸‹æ–‡
â”œâ”€ 2. ç”Ÿæˆå¤±è´¥æµ‹è¯•
â”œâ”€ 3. æäº¤æµ‹è¯•
â”‚   Commit: "test: æ·»åŠ  xxx åŠŸèƒ½çš„å¤±è´¥æµ‹è¯• (#123)"
â”‚
ğŸŸ¢ GREEN é˜¶æ®µ
â”œâ”€ 4. ç”Ÿæˆä¿®å¤ä»£ç 
â”œâ”€ 5. éªŒè¯ä¿®å¤ (æœ¬åœ°æµ‹è¯•)
â”œâ”€ 6. æäº¤ä¿®å¤
â”‚   Commit: "feat: å®ç°ä½¿æµ‹è¯•é€šè¿‡çš„ xxx åŠŸèƒ½ (#123)"
â”‚
ğŸ“š DOCS é˜¶æ®µ (ä»…åŠŸèƒ½æ·»åŠ )
â”œâ”€ 7. åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–° README
â”‚   â””â”€ æ¡ä»¶ï¼šCLI åŠŸèƒ½æ·»åŠ  (cli.py, formatter.py)
â”œâ”€ 8. ç”Ÿæˆ README æ›´æ–°
â”œâ”€ 9. æäº¤æ–‡æ¡£
â”‚   Commit: "docs: æ›´æ–° README ä½¿ç”¨ç¤ºä¾‹ (#123)"
â”‚
CI ç›‘æ§
â”œâ”€ 10. æ¨é€åˆ°è¿œç¨‹
â”œâ”€ 11. ç­‰å¾… CI é€šè¿‡ (æœ€å¤š 30 åˆ†é’Ÿ)
â”œâ”€ 12. å¤±è´¥åˆ™è‡ªåŠ¨å›æ»š
â”‚
å®Œæˆ
â””â”€ 13. å…³é—­ Issue
```

> **æ³¨æ„**ï¼šå†…éƒ¨é‡æ„ã€Bug ä¿®å¤ã€æµ‹è¯•è¡¥å……ä¸éœ€è¦æ›´æ–° READMEã€‚åªæœ‰æ–°å¢ CLI åŠŸèƒ½æ—¶æ‰è§¦å‘ ğŸ“š DOCS é˜¶æ®µã€‚

### 3.1 ğŸ”´ RED é˜¶æ®µ - ç”Ÿæˆæµ‹è¯•

**ç›®çš„**ï¼šå…ˆå†™ä¸€ä¸ªå¤±è´¥çš„æµ‹è¯•ï¼Œæ˜ç¡®éœ€æ±‚

```python
def generate_test(issue) -> dict:
    """ç”Ÿæˆå¤±è´¥æµ‹è¯•"""
    prompt = """
    ä¸ºä»¥ä¸‹é—®é¢˜ç¼–å†™å•å…ƒæµ‹è¯•ï¼ˆTDD ç¬¬ä¸€æ­¥ï¼‰ï¼š

    é—®é¢˜æè¿°ï¼š{title}
    è¯¦æƒ…ï¼š{body}
    å½“å‰ä»£ç ï¼š{file_content}

    è¦æ±‚ï¼š
    1. ä½¿ç”¨ AAA æ¨¡å¼ (Arrange-Act-Assert)
    2. æµ‹è¯•å‘½åï¼štest_åŠŸèƒ½_æ¡ä»¶_æœŸæœ›
    3. åŒ…å«æ­£å¸¸æƒ…å†µå’Œè¾¹ç•Œæƒ…å†µ
    4. æµ‹è¯•åº”è¯¥åœ¨å½“å‰ä»£ç ä¸‹å¤±è´¥ï¼ˆå› ä¸ºé—®é¢˜è¿˜æ²¡ä¿®å¤ï¼‰

    ä»¥ JSON æ ¼å¼è¿”å›ï¼š
    {
        "test_file": "tests/test_xxx.py",
        "test_code": "å®Œæ•´çš„æµ‹è¯•ä»£ç ",
        "description": "æµ‹è¯•è¯´æ˜"
    }
    """
    return claude.chat(prompt)
```

**æäº¤æ ¼å¼**ï¼š
```
test: æ·»åŠ  get_next_id ç©ºåˆ—è¡¨åœºæ™¯çš„å¤±è´¥æµ‹è¯• (#42)

æµ‹è¯•ç©ºåˆ—è¡¨æ—¶ get_next_id() åº”è¿”å› 1
è€ŒéæŠ›å‡º IndexError

ğŸ”´ RED - TDD Phase 1: å…ˆå†™ä¸€ä¸ªå¤±è´¥çš„æµ‹è¯•

Issue: [Bug] get_next_id åœ¨ç©ºåˆ—è¡¨æ—¶å´©æºƒ
Test file: tests/test_storage.py

---
AI-generated test by AI Flywheel
Model: claude-opus-4.5
Generated: 2025-12-29T10:30:00
Closes #42
```

### 3.2 ğŸŸ¢ GREEN é˜¶æ®µ - ç”Ÿæˆä¿®å¤

**ç›®çš„**ï¼šå†™æœ€å°‘çš„ä»£ç ä½¿æµ‹è¯•é€šè¿‡

```python
def generate_fix(issue) -> dict:
    """ç”Ÿæˆä¿®å¤ä»£ç """
    prompt = """
    ä¿®å¤ä»¥ä¸‹é—®é¢˜ï¼ˆTDD ç¬¬äºŒæ­¥ï¼‰ï¼š

    é—®é¢˜æè¿°ï¼š{title}
    è¯¦æƒ…ï¼š{body}
    å½“å‰ä»£ç ï¼š{file_content}

    è¯·æä¾›ä¿®å¤åçš„ä»£ç ï¼Œç¡®ä¿ç›¸å…³æµ‹è¯•èƒ½å¤Ÿé€šè¿‡ã€‚

    ä»¥ JSON æ ¼å¼è¿”å›ï¼š
    {
        "fixed_code": "ä¿®å¤åçš„å®Œæ•´ä»£ç ",
        "explanation": "ä¿®å¤è¯´æ˜",
        "confidence": 85  # ç½®ä¿¡åº¦ 0-100
    }
    """
    return claude.chat(prompt)
```

**æäº¤æ ¼å¼**ï¼š
```
feat: ä¿®å¤ get_next_id ç©ºåˆ—è¡¨è¾¹ç•Œå¤„ç† (#42)

æ·»åŠ ç©ºåˆ—è¡¨æ£€æŸ¥ï¼Œè¿”å›é»˜è®¤å€¼ 1

ğŸŸ¢ GREEN - TDD Phase 2: å®ç°ä½¿æµ‹è¯•é€šè¿‡çš„åŠŸèƒ½

Issue: [Bug] get_next_id åœ¨ç©ºåˆ—è¡¨æ—¶å´©æºƒ

---
AI-generated fix by AI Flywheel
Model: claude-opus-4.5
Confidence: 85%
Generated: 2025-12-29T10:35:00
Closes #42
```

### 3.3 â™»ï¸ REFACTOR é˜¶æ®µ - é‡æ„ï¼ˆå¯é€‰ï¼‰

**ç›®çš„**ï¼šä¼˜åŒ–ä»£ç ç»“æ„ï¼Œä¿æŒæµ‹è¯•é€šè¿‡

```python
def refactor_code(issue) -> dict:
    """é‡æ„ä»£ç """
    prompt = """
    é‡æ„ä»¥ä¸‹ä»£ç ï¼ˆTDD ç¬¬ä¸‰æ­¥ï¼‰ï¼š

    å½“å‰ä»£ç ï¼š{file_content}
    æµ‹è¯•çŠ¶æ€ï¼šå…¨éƒ¨é€šè¿‡

    è¯·ä¼˜åŒ–ä»£ç ç»“æ„ï¼š
    1. æå–é‡å¤é€»è¾‘
    2. æ”¹å–„å‘½å
    3. ç®€åŒ–å¤æ‚åº¦

    çº¦æŸï¼šä¸èƒ½æ”¹å˜åŠŸèƒ½è¡Œä¸ºï¼Œæ‰€æœ‰æµ‹è¯•å¿…é¡»é€šè¿‡

    ä»¥ JSON æ ¼å¼è¿”å›ï¼š
    {
        "refactored_code": "é‡æ„åçš„ä»£ç ",
        "changes": ["å˜æ›´è¯´æ˜åˆ—è¡¨"]
    }
    """
    return claude.chat(prompt)
```

**æäº¤æ ¼å¼**ï¼š
```
refactor: ç®€åŒ– Storage ç±»çš„å¾ªç¯é€»è¾‘ (#42)

ä½¿ç”¨ next() æ›¿ä»£ for å¾ªç¯ï¼Œæå‡å¯è¯»æ€§

â™»ï¸ REFACTOR - TDD Phase 3: ä¼˜åŒ–ä»£ç ç»“æ„

Issue: [Bug] get_next_id åœ¨ç©ºåˆ—è¡¨æ—¶å´©æºƒ

Changes:
- ä½¿ç”¨ next() + default æ›¿ä»£ for å¾ªç¯
- ç§»é™¤ä¸´æ—¶å˜é‡

---
AI-generated refactor by AI Flywheel
Model: claude-opus-4.5
Generated: 2025-12-29T10:40:00
Closes #42
```

### 3.4 ğŸ“š DOCS é˜¶æ®µ - æ›´æ–°æ–‡æ¡£ï¼ˆå¯é€‰ï¼‰

**ç›®çš„**ï¼šæ–°å¢åŠŸèƒ½ååŒæ­¥æ›´æ–° README æ–‡æ¡£

**è§¦å‘æ¡ä»¶**ï¼š
```python
def should_update_readme(fix: dict, issue: dict) -> bool:
    """åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–° README"""
    issue_title = issue["title"].lower()
    file_path = fix["file"]

    # 1. æ˜¯åŠŸèƒ½æ·»åŠ 
    is_feature = any(kw in issue_title for kw in
                     ["feat", "åŠŸèƒ½", "æ–°å¢", "æ·»åŠ ", "add", "feature"])

    # 2. ä¿®æ”¹çš„æ˜¯ CLI æ–‡ä»¶
    is_cli = "cli.py" in file_path or "formatter.py" in file_path

    # 3. æ’é™¤å†…éƒ¨æ”¹åŠ¨
    is_internal = any(kw in issue_title for kw in
                      ["refactor", "é‡æ„", "test", "æµ‹è¯•", "fix", "ä¿®å¤"])

    # 4. æ’é™¤æœ¬èº«å°±æ˜¯æ–‡æ¡£æ”¹åŠ¨
    is_docs = "docs" in file_path or "readme" in file_path.lower()

    return is_feature and is_cli and not (is_internal or is_docs)
```

**æ›´æ–°é€»è¾‘**ï¼š
```python
def update_readme(fix: dict, issue: dict) -> str:
    """æ›´æ–° README.md"""
    # 1. è¯»å–å½“å‰ README
    current_readme = Path("README.md").read_text()

    # 2. è®© Claude ç”Ÿæˆæ›´æ–°
    prompt = f"""
æ ¹æ®ä»¥ä¸‹ä»£ç ä¿®å¤ï¼Œæ›´æ–° README.mdï¼š

é—®é¢˜æè¿°ï¼š{issue['title']}
ä¿®æ”¹æ–‡ä»¶ï¼š{fix['file']}

å½“å‰ READMEï¼š
{current_readme[:3000]}

è¯·ï¼š
1. åœ¨"## åŠŸèƒ½"éƒ¨åˆ†æ·»åŠ æ–°åŠŸèƒ½è¯´æ˜
2. åœ¨"## å¿«é€Ÿå¼€å§‹"ä¸­æ·»åŠ ä½¿ç”¨ç¤ºä¾‹
3. ä¿æŒå…¶ä»–å†…å®¹ä¸å˜

è¿”å› JSONï¼š
{{
    "readme_content": "å®Œæ•´å†…å®¹",
    "changes": ["å˜æ›´è¯´æ˜"]
}}
"""

    # 3. æäº¤æ–‡æ¡£æ›´æ–°
    result = claude.chat(prompt)
    commit_changes({"README.md": result["readme_content"]},
                   message="docs: æ›´æ–° README ä½¿ç”¨ç¤ºä¾‹")
```

**æäº¤æ ¼å¼**ï¼š
```
docs: æ›´æ–° README ä½¿ç”¨ç¤ºä¾‹ (æ·»åŠ æœç´¢åŠŸèƒ½) (#42)

- åœ¨"åŠŸèƒ½"éƒ¨åˆ†æ·»åŠ  `search` å‘½ä»¤è¯´æ˜
- åœ¨"å¿«é€Ÿå¼€å§‹"ä¸­æ·»åŠ æœç´¢ä½¿ç”¨ç¤ºä¾‹

ğŸ“š æ–‡æ¡£åŒæ­¥ - æ–°åŠŸèƒ½ä½¿ç”¨è¯´æ˜

Issue: [Feat] æ·»åŠ  Todo æœç´¢åŠŸèƒ½

---
AI-generated documentation by AI Flywheel
Model: claude-opus-4.5
Generated: 2025-12-29T10:45:00
Related to #42
```

---

## 4. å®‰å…¨æœºåˆ¶

### 4.1 ä¿®å¤å‰éªŒè¯

```python
def validate_fix(fix: dict) -> bool:
    """éªŒè¯ä¿®å¤æ–¹æ¡ˆ"""
    checks = [
        # 1. ä¿®å¤å†…å®¹éç©º
        fix.get("content"),
        # 2. ç½®ä¿¡åº¦ >= 50%
        fix.get("confidence", 0) >= 50,
        # 3. æ–‡ä»¶è·¯å¾„åœ¨å…è®¸èŒƒå›´å†…
        not any(p in fix["file"] for p in BLOCKED_PATTERNS),
    ]
    return all(checks)

BLOCKED_PATTERNS = [
    ".github", "config/", "secrets/",
    ".env", ".key", ".pem"
]
```

### 4.2 ä¿®å¤åéªŒè¯

```python
def verify_fix() -> bool:
    """éªŒè¯ä¿®å¤æ•ˆæœ"""
    # 1. è¿è¡Œæœ¬åœ°æµ‹è¯•
    if not run_tests():
        return False

    # 2. è¿è¡Œ linter
    if not run_linter():
        return False

    # 3. æ£€æŸ¥æµ‹è¯•è¦†ç›–ç‡
    if not check_coverage():
        return False

    return True
```

### 4.3 CI ç›‘æ§ä¸è‡ªåŠ¨å›æ»š

```python
def monitor_and_rollback(commit_sha: str, issue: dict) -> bool:
    """ç›‘æ§ CIï¼Œå¤±è´¥åˆ™å›æ»š"""

    # 1. æ¨é€æäº¤
    push()

    # 2. ç­‰å¾… CI (æœ€å¤š 30 åˆ†é’Ÿ)
    ci_passed = get_ci_status(timeout=1800)

    if not ci_passed:
        # 3. CI å¤±è´¥ï¼Œæ‰§è¡Œå›æ»š
        logger.warning("CI failed, rolling back")

        # 4. Revert æäº¤
        revert_sha = revert_commit(commit_sha)

        # 5. å¼ºåˆ¶æ¨é€
        push(force=True)

        # 6. é‡æ–°æ‰“å¼€ Issue
        reopen_issue(issue["number"])

        # 7. æ£€æŸ¥æ˜¯å¦éœ€è¦ç†”æ–­
        if failed_count >= 3:
            trigger_circuit_breaker()

        return False

    return True
```

### 4.4 ç†”æ–­æœºåˆ¶

```python
# è¿ç»­å¤±è´¥ 3 æ¬¡åè§¦å‘ç†”æ–­
CIRCUIT_BREAKER_THRESHOLD = 3

def trigger_circuit_breaker():
    """è§¦å‘ç†”æ–­"""
    # 1. æ‰€æœ‰ Issue æ·»åŠ  frozen æ ‡ç­¾
    for issue in get_open_issues():
        add_label(issue, "frozen")

    # 2. å‘é€å‘Šè­¦é€šçŸ¥
    send_alert("Circuit breaker triggered!")

    # 3. åœæ­¢è‡ªåŠ¨ä¿®å¤
    logger.error("Circuit breaker: paused all fixes")
```

---

## 5. Commit è§„èŒƒ

### 5.1 Commit ç±»å‹

```python
def get_commit_type(issue_title: str) -> str:
    """ä» Issue æ ‡é¢˜æ¨æ–­ commit ç±»å‹"""
    title_lower = issue_title.lower()

    if any(kw in title_lower for kw in ["bug", "ä¿®å¤", "fix"]):
        return "fix"
    if any(kw in title_lower for kw in ["test", "æµ‹è¯•"]):
        return "test"
    if any(kw in title_lower for kw in ["refactor", "é‡æ„"]):
        return "refactor"
    if any(kw in title_lower for kw in ["doc", "æ–‡æ¡£"]):
        return "docs"
    if any(kw in title_lower for kw in ["feat", "åŠŸèƒ½"]):
        return "feat"
    if any(kw in title_lower for kw in ["perf", "æ€§èƒ½"]):
        return "perf"

    return "chore"  # é»˜è®¤
```

### 5.2 Commit æ ¼å¼

éµå¾ª [Conventional Commits](https://www.conventionalcommits.org/) è§„èŒƒï¼š

```
<type>: <short description> (#<issue_number>)

<body>

<footer>
```

**ç¤ºä¾‹**ï¼š
```
feat: å¢åŠ  Todo ä¼˜å…ˆçº§æ’åºåŠŸèƒ½ (#12)

å®ç° Todo åˆ—è¡¨æŒ‰ä¼˜å…ˆçº§é«˜ä½æ’åº

- æ·»åŠ  Priority æšä¸¾ (HIGH, MEDIUM, LOW)
- Storage.list() æ”¯æŒæŒ‰ä¼˜å…ˆçº§æ’åº
- CLI å¢åŠ  --sort é€‰é¡¹

Issue: [Feat] æ”¯æŒæŒ‰ä¼˜å…ˆçº§æ’åº Todo åˆ—è¡¨

---
AI-generated fix by AI Flywheel
Model: claude-opus-4.5
Confidence: 90%
Generated: 2025-12-29T15:30:00
Closes #12
```

### 5.3 TDD ç‰¹æ®Šæ ¼å¼

| é˜¶æ®µ | Commit ç±»å‹ | è¯´æ˜ | è§¦å‘æ¡ä»¶ |
|------|-------------|------|----------|
| ğŸ”´ RED | `test:` | æ·»åŠ å¤±è´¥æµ‹è¯• | æ¯ä¸ª Issue |
| ğŸŸ¢ GREEN | `feat:` / `fix:` | å®ç°åŠŸèƒ½/ä¿®å¤ bug | æ¯ä¸ª Issue |
| ğŸ“š DOCS | `docs:` | æ›´æ–° README æ–‡æ¡£ | ä»… CLI åŠŸèƒ½æ·»åŠ  |
| â™»ï¸ REFACTOR | `refactor:` | é‡æ„ä»£ç  | å¯é€‰ |

---

## 6. äººç±»æ§åˆ¶ç‚¹

### 6.1 ä¼˜å…ˆçº§æ§åˆ¶

```bash
# æå‡ Issue ä¼˜å…ˆçº§
gh issue edit 42 --add-label "p0" --remove-label "p2"

# æ‰¹é‡æå‡å®‰å…¨é—®é¢˜
gh issue list --search "[Security]" | \
  xargs -I {} gh issue edit {} --add-label "p0"

# å†»ç»“æ‰€æœ‰ Issue
gh issue list | \
  xargs -I {} gh issue edit {} --add-label "frozen"
```

### 6.2 æŸ¥çœ‹å†å²

```bash
# æŸ¥çœ‹ AI çš„æ‰€æœ‰æäº¤
git log --author="AI Flywheel" --oneline

# æŸ¥çœ‹æŸä¸ª Issue çš„ä¿®å¤
git log --grep="#42"

# æŸ¥çœ‹æäº¤è¯¦æƒ…
git show <commit-sha>
```

### 6.3 æ‰‹åŠ¨å›æ»š

```bash
# å›æ»šæœ€è¿‘ä¸€æ¬¡æäº¤
git revert HEAD
git push

# å›æ»šæŒ‡å®šæäº¤
git revert <commit-sha>
git push

# è§£å†» Issue
gh issue edit 42 --remove-label "frozen"
```

---

## 7. ç¯å¢ƒå˜é‡

| å˜é‡ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `MAX_FIXES` | 3 | å•æ¬¡è¿è¡Œæœ€å¤§ä¿®å¤æ•° |
| `CI_TIMEOUT` | 1800 | CI ç­‰å¾…è¶…æ—¶ï¼ˆç§’ï¼‰ |
| `LOG_LEVEL` | INFO | æ—¥å¿—çº§åˆ« |
| `ANTHROPIC_API_KEY` | å¿…å¡« | Claude API å¯†é’¥ |
| `TARGET_DIR` | src | æ‰«æç›®æ ‡ç›®å½• |

---

## 8. é¡¹ç›®ç»“æ„

```
flywheel/
â”œâ”€â”€ .github/workflows/
â”‚   â”œâ”€â”€ scan.yml        # æ‰«æä»£ç ï¼Œåˆ›å»º Issue
â”‚   â”œâ”€â”€ evaluate.yml    # è¯„ä¼°ä¼˜å…ˆçº§
â”‚   â””â”€â”€ fix.yml         # TDD è‡ªåŠ¨ä¿®å¤
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ shared/
â”‚   â”‚   â”œâ”€â”€ claude.py   # Claude API å°è£…
â”‚   â”‚   â””â”€â”€ utils.py    # å·¥å…·å‡½æ•°
â”‚   â”‚
â”‚   â”œâ”€â”€ scan.py         # æ‰«æå™¨
â”‚   â”œâ”€â”€ evaluate.py     # è¯„ä¼°å™¨
â”‚   â””â”€â”€ fix.py          # ä¿®å¤å™¨ (TDD)
â”‚
â”œâ”€â”€ src/flywheel/       # Todo CLI (ç›®æ ‡é¡¹ç›®)
â”‚   â”œâ”€â”€ todo.py         # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ storage.py      # å­˜å‚¨åç«¯
â”‚   â”œâ”€â”€ formatter.py    # è¾“å‡ºæ ¼å¼åŒ–
â”‚   â””â”€â”€ cli.py          # CLI å…¥å£
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_todo.py
â”‚   â””â”€â”€ test_storage.py
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ workflow.md     # æœ¬æ–‡æ¡£
â”‚   â”œâ”€â”€ prd.md          # äº§å“éœ€æ±‚æ–‡æ¡£
â”‚   â””â”€â”€ arch.md         # æ¶æ„è®¾è®¡
â”‚
â”œâ”€â”€ pyproject.toml      # é¡¹ç›®é…ç½®
â””â”€â”€ README.md           # å·¥å…·è¯´æ˜
```

---

## 9. å·¥ä½œæµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æŒç»­å¾ªç¯ (æ¯å°æ—¶/2å°æ—¶)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    æ¯å°æ—¶ (æ•´ç‚¹)
                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         Scan (æ‰«æä»£ç )               â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚ 1. æ‰«æ src/ ç›®å½•               â”‚  â”‚
        â”‚  â”‚ 2. Claude åˆ†æä»£ç è´¨é‡          â”‚  â”‚
        â”‚  â”‚ 3. åˆ›å»º GitHub Issue            â”‚  â”‚
        â”‚  â”‚ 4. è‡ªåŠ¨æ‰“æ ‡ç­¾ (p0-p3)           â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    Issue åˆ›å»ºå
                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚       Evaluate (è¯„ä¼°ä¼˜å…ˆçº§)           â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚ 1. åˆ†æ Issue ç±»å‹              â”‚  â”‚
        â”‚  â”‚ 2. è®¡ç®—ä¼˜å…ˆçº§åˆ†æ•°               â”‚  â”‚
        â”‚  â”‚ 3. äººç±»å¯è°ƒæ•´æ ‡ç­¾               â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    æ¯ 2 å°æ—¶ (æˆ– p0 å³æ—¶)
                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         Fix (TDD è‡ªåŠ¨ä¿®å¤)            â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚ ğŸ”´ RED                          â”‚  â”‚
        â”‚  â”‚   â”œâ”€ ç”Ÿæˆå¤±è´¥æµ‹è¯•               â”‚  â”‚
        â”‚  â”‚   â””â”€ Commit: test: ...          â”‚  â”‚
        â”‚  â”‚                                 â”‚  â”‚
        â”‚  â”‚ ğŸŸ¢ GREEN                        â”‚  â”‚
        â”‚  â”‚   â”œâ”€ ç”Ÿæˆä¿®å¤ä»£ç                â”‚  â”‚
        â”‚  â”‚   â”œâ”€ è¿è¡Œæœ¬åœ°æµ‹è¯•               â”‚  â”‚
        â”‚  â”‚   â””â”€ Commit: feat: ...          â”‚  â”‚
        â”‚  â”‚                                 â”‚  â”‚
        â”‚  â”‚ ğŸ“š DOCS (å¯é€‰)                  â”‚  â”‚
        â”‚  â”‚   â”œâ”€ æ›´æ–° README                â”‚  â”‚
        â”‚  â”‚   â””â”€ Commit: docs: ...          â”‚  â”‚
        â”‚  â”‚                                 â”‚  â”‚
        â”‚  â”‚ CI ç›‘æ§                         â”‚  â”‚
        â”‚  â”‚   â”œâ”€ æ¨é€è¿œç¨‹                   â”‚  â”‚
        â”‚  â”‚   â”œâ”€ ç­‰å¾… CI (æœ€å¤š 30min)       â”‚  â”‚
        â”‚  â”‚   â””â”€ å¤±è´¥åˆ™å›æ»š + é‡å¼€ Issue    â”‚  â”‚
        â”‚  â”‚                                 â”‚  â”‚
        â”‚  â”‚ å®Œæˆ                            â”‚  â”‚
        â”‚  â”‚   â””â”€ å…³é—­ Issue                 â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚             â”‚
                 æˆåŠŸ           å¤±è´¥
                    â”‚             â”‚
                    â–¼             â–¼
               å…³é—­ Issue      å›æ»š + ç†”æ–­
```

---

## 10. å…¸å‹åœºæ™¯

### åœºæ™¯ 1ï¼šæµ‹è¯•ç¼ºå¤±
```
1. Scan å‘ç°ç¼ºå°‘ get_next_id() çš„æµ‹è¯•
2. åˆ›å»º Issue: "[Test] get_next_id è¾¹ç•Œæµ‹è¯•"
3. è‡ªåŠ¨æ‰“æ ‡ç­¾: p2
4. Fix é˜¶æ®µ TDD:
   ğŸ”´ RED: ç”Ÿæˆå¤±è´¥æµ‹è¯• â†’ commit
   ğŸŸ¢ GREEN: å®ç° fix â†’ commit
5. CI é€šè¿‡ï¼Œå…³é—­ Issue
```

### åœºæ™¯ 2ï¼šBug ä¿®å¤
```
1. Scan å‘ç°ç©ºæŒ‡é’ˆé£é™©
2. åˆ›å»º Issue: "[Bug] Storage.get() æœªæ£€æŸ¥ None"
3. äººç±»æ”¹ä¸º p0 (ä¸¥é‡ bug)
4. Fix å³æ—¶è§¦å‘:
   ğŸ”´ RED: ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ â†’ commit
   ğŸŸ¢ GREEN: æ·»åŠ  None æ£€æŸ¥ â†’ commit
5. CI é€šè¿‡ï¼Œå…³é—­ Issue
```

### åœºæ™¯ 3ï¼šè‡ªåŠ¨å›æ»š
```
1. AI ç”Ÿæˆä¿®å¤å¹¶æäº¤
2. CI æ£€æµ‹åˆ°æµ‹è¯•å¤±è´¥
3. è‡ªåŠ¨è§¦å‘å›æ»š:
   - git revert <commit>
   - force push
   - é‡æ–°æ‰“å¼€ Issue
   - é™ä½ä¼˜å…ˆçº§ (p0 â†’ p3)
4. å¤±è´¥è®¡æ•° +1
5. è¿ç»­ 3 æ¬¡å¤±è´¥ â†’ ç†”æ–­
```

---

## å‚è€ƒèµ„æ–™

- [Conventional Commits](https://www.conventionalcommits.org/)
- [TDD æœ€ä½³å®è·µ](https://martinfowler.com/bliki/TestDrivenDevelopment.html)
- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)
- [Claude API æ–‡æ¡£](https://docs.anthropic.com/)
