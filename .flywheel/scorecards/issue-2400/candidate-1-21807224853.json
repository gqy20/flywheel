{
  "issue_number": 2400,
  "candidate_id": "candidate-1-21807224853",
  "stage": "FINALIZE",
  "title": "Unicode bidirectional control character sanitization",
  "severity": "p0",
  "vulnerability_type": "trojan_source_spoofing",
  "tdd_plan": {
    "test_file": "tests/test_issue_2400_bidi_control_sanitization.py",
    "source_file": "src/flywheel/formatter.py",
    "function_to_modify": "_sanitize_text",
    "test_approach": [
      "RED: Add failing test for U+202A-U+202E bidi control characters",
      "RED: Add failing test for U+2066-U+2069 bidi control characters",
      "RED: Add test that normal Unicode passes through unchanged",
      "GREEN: Extend condition to include bidi ranges",
      "VERIFY: Run uv run pytest tests/test_issue_2400_bidi_control_sanitization.py",
      "VERIFY: Run uv run pytest tests/ for regression",
      "VERIFY: Run uv run ruff check src/flywheel/formatter.py"
    ]
  },
  "bidi_ranges": {
    "U+202A-U+202E": ["LRE", "RLE", "PDF", "LRO", "RLO"],
    "U+2066-U+2069": ["LRI", "RLI", "FSI", "PDI"]
  },
  "acceptance_criteria": [
    "Unicode bidi control chars U+202A-U+202E are escaped to \\uXXXX format",
    "Unicode bidi control chars U+2066-U+2069 are escaped to \\uXXXX format",
    "Normal Unicode text (Chinese, Japanese, emojis) passes through unchanged",
    "Existing tests for normal Unicode continue to pass"
  ]
}
