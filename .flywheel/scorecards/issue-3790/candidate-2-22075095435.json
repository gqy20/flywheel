{
  "issue_number": 3790,
  "issue_title": "[Bug] next_id() may return duplicate IDs when todos list has non-contiguous IDs",
  "candidate_number": 2,
  "run_id": "22075095435",
  "branch": "claude/issue-3790-candidate-2-22075095435",
  "created_at": "2026-02-16T19:15:00Z",
  "status": "implemented",
  "approach": "gap-filling",
  "summary": "Changed next_id() to return smallest unused positive integer instead of max+1. This fills gaps in non-contiguous ID sequences that occur after deletions.",
  "test_files": [
    "tests/test_minimal_framework.py"
  ],
  "tests_added": [
    "test_storage_next_id_fills_gaps_in_non_contiguous_ids",
    "test_storage_next_id_returns_1_for_empty_list",
    "test_storage_next_id_returns_next_after_contiguous_ids"
  ],
  "source_files_changed": [
    "src/flywheel/storage.py"
  ],
  "risks": [
    "Existing users may expect max+1 behavior for deterministic ID ordering"
  ],
  "limitations": [],
  "commands_run": [
    "uv run pytest tests/test_minimal_framework.py -v",
    "uv run pytest --tb=short",
    "uv run ruff check src/flywheel/storage.py tests/test_minimal_framework.py",
    "uv run ruff format --check src/flywheel/storage.py tests/test_minimal_framework.py"
  ]
}
