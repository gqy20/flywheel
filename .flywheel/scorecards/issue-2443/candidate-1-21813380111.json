{
  "issue_number": 2443,
  "candidate_number": 1,
  "run_id": "21813380111",
  "stage": "FINALIZE",
  "pr_url": "https://github.com/gqy20/flywheel/pull/2449",
  "commit_hash": "908607e",
  "tdd_plan": {
    "problem_summary": "fdopen context manager closes the file descriptor but os.unlink(temp_path) in except handler needs proper cleanup handling. If fchmod fails, the fd must be closed before unlinking the temp file.",
    "files_to_touch": [
      "tests/test_issue_2443_fdopen_cleanup.py",
      "src/flywheel/storage.py"
    ],
    "red_phase_tests": [
      "test_fchmod_failure_does_not_leak_fd",
      "test_fdopen_failure_does_not_leak_fd",
      "test_fchmod_failure_cleans_up_temp_file",
      "test_fdopen_failure_cleans_up_temp_file",
      "test_normal_operation_still_works"
    ],
    "green_phase_implementation": [
      "Added explicit os.close(fd) in except handler with contextlib.suppress",
      "Ensured fd is closed if fdopen never took ownership"
    ],
    "verification_commands": [
      "uv run pytest tests/test_issue_2443_fdopen_cleanup.py -v",
      "uv run pytest tests/test_issue_2027_permissions.py -v",
      "uv run pytest tests/test_storage_atomicity.py -v",
      "uv run ruff check src/flywheel/storage.py"
    ],
    "verification_results": {
      "test_issue_2443": "5 passed",
      "test_issue_2027": "2 passed",
      "test_storage_atomicity": "6 passed",
      "ruff_check": "All checks passed"
    }
  }
}
